# üöÄ Code Execution System - Like LeetCode & GeeksforGeeks

## Overview

The DSA Platform now includes a comprehensive code execution and testing system similar to LeetCode and GeeksforGeeks. This system provides detailed feedback on code submissions, showing exactly which test cases pass or fail and why.

---

## ‚ú® Features

### 1. **Detailed Test Case Results**
- ‚úÖ Shows pass/fail status for each test case
- üì• Displays input for each test
- ‚úÖ Shows expected output
- ‚ùå Shows actual output from your code
- üí° Provides explanations for why tests failed

### 2. **Compilation Error Detection**
- Checks code for syntax errors before execution
- Shows detailed error messages with line numbers
- Prevents submission of invalid code

### 3. **Runtime Error Handling**
- Catches and displays runtime errors
- Shows error message and stack trace
- Helps identify bugs in logic

### 4. **Multiple Status Types**
- ‚úÖ **Accepted** - All test cases passed
- ‚ùå **Wrong Answer** - Some test cases failed
- ‚ö†Ô∏è **Partial Pass** - Some tests passed, some failed
- üî¥ **Runtime Error** - Code crashed during execution
- üü£ **Compilation Error** - Syntax errors in code
- ‚è±Ô∏è **Time Limit Exceeded** - Code took too long

### 5. **Performance Metrics**
- Runtime measurement (milliseconds)
- Memory usage (MB)
- Performance comparison across test cases

### 6. **Two Execution Modes**

#### **Run Code** (Blue Button)
- Tests against visible test cases only
- Quick feedback for development
- Doesn't count as submission
- Results shown in "Test Cases" tab

#### **Submit** (Green Button)
- Tests against all test cases (including hidden)
- Counts as official submission
- Updates user statistics
- Results shown in "Submission" tab

---

## üèóÔ∏è Architecture

### Backend Components

#### 1. **Code Executor** (`backend/utils/codeExecutor.js`)

Main execution engine that:
- Compiles code to check for syntax errors
- Executes code against test cases
- Measures performance (runtime, memory)
- Compares outputs with expected results
- Generates detailed error explanations

**Key Functions:**

```javascript
// Execute code against all test cases
executeCode(code, language, testCases, functionName)

// Check for compilation errors
compileCode(code, language)

// Execute single test case
executeTestCase(code, language, testCase, testNumber, functionName)

// Compare outputs
compareOutputs(actual, expected)

// Generate error explanations
generateErrorExplanation(input, expected, actual)
```

#### 2. **Submissions Route** (`backend/routes/submissions.js`)

Updated endpoints:

```javascript
// Submit solution (all test cases)
POST /api/submissions
Body: { problemId, code, language }

// Run code (visible test cases only)
POST /api/submissions/run
Body: { problemId, code, language }
```

#### 3. **Submission Model** (`backend/models/Submission.js`)

Enhanced schema with detailed test results:

```javascript
{
  user: ObjectId,
  problem: ObjectId,
  code: String,
  language: String,
  status: String, // Accepted, Wrong Answer, etc.
  runtime: String,
  memory: String,
  testCasesPassed: Number,
  totalTestCases: Number,
  testResults: [{
    testNumber: Number,
    passed: Boolean,
    input: String,
    expectedOutput: String,
    actualOutput: String,
    runtime: Number,
    memory: Number,
    hidden: Boolean,
    errorMessage: String,
    explanation: String
  }],
  errorMessage: String,
  submittedAt: Date
}
```

### Frontend Components

#### 1. **TestResults Component** (`frontend/src/components/TestResults.jsx`)

Displays execution results in LeetCode-style UI:

**Features:**
- Overall status indicator (Accepted/Wrong Answer)
- Test case breakdown
- Input/Output comparison
- Error explanations
- Debugging tips
- Performance metrics
- Hidden test cases indicator

**Props:**
```javascript
<TestResults 
  executionResult={executionResult}
  showAllTests={false}  // false for Run, true for Submit
/>
```

#### 2. **ProblemDetail Page** (`frontend/src/pages/ProblemDetail.jsx`)

Updated with:
- **Run Code** button (blue) - Tests visible cases
- **Submit** button (green) - Tests all cases
- **Test Cases** tab - Shows run results
- **Submission** tab - Shows submission results
- Real-time execution state

---

## üìä Execution Flow

### Run Code Flow

```
User clicks "Run Code"
     ‚Üì
Frontend ‚Üí POST /api/submissions/run
     ‚Üì
Backend: compileCode()
     ‚Üì
Backend: executeCode() (visible tests only)
     ‚Üì
Frontend: Display in "Test Cases" tab
```

### Submit Code Flow

```
User clicks "Submit"
     ‚Üì
Frontend ‚Üí POST /api/submissions
     ‚Üì
Backend: compileCode()
     ‚Üì
Backend: executeCode() (all tests)
     ‚Üì
Backend: Save submission to database
     ‚Üì
Backend: Update problem stats
     ‚Üì
Backend: Update user solved problems (if accepted)
     ‚Üì
Frontend: Display in "Submission" tab
```

---

## üß™ Test Case Structure

Each test case in the database includes:

```javascript
{
  input: "[[1,2],[3,4]]",      // Input as string
  expectedOutput: "10",         // Expected result
  isHidden: false,              // Visible or hidden
}
```

### Test Case Processing

1. **Parse Input**: Convert string to appropriate data type
   ```javascript
   "[1,2,3]" ‚Üí [1, 2, 3]
   "5" ‚Üí 5
   ```

2. **Execute Code**: Run user's function with parsed input

3. **Compare Outputs**: Deep comparison of results
   ```javascript
   Expected: [1,2,3]
   Actual:   [1,2,3]  ‚úÖ Match
   
   Expected: [1,2,3]
   Actual:   [1,3,2]  ‚ùå No Match
   ```

4. **Generate Explanation**: If wrong, explain why
   ```
   ‚ùå Wrong Answer
   
   üì• Input: [1,2,3,4]
   ‚úÖ Expected: 10
   ‚ùå Your Output: 8
   
   üí° Explanation:
   Numerical difference: 2
   ```

---

## üé® UI Components

### Status Indicators

| Status | Color | Icon | Description |
|--------|-------|------|-------------|
| Accepted | Green | ‚úÖ | All tests passed |
| Wrong Answer | Red | ‚ùå | Some tests failed |
| Partial Pass | Red | ‚ùå | Some passed, some failed |
| Runtime Error | Orange | ‚ö†Ô∏è | Code crashed |
| Compilation Error | Purple | üîß | Syntax errors |

### Test Case Display

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‚úÖ Test Case 1                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ Input:                              ‚îÇ
‚îÇ [1, 2, 3, 4]                        ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ Expected Output:                    ‚îÇ
‚îÇ 10                                  ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ Your Output:                        ‚îÇ
‚îÇ 10                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Error Explanation

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üí° Why this failed:                 ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ Your solution produced incorrect    ‚îÇ
‚îÇ output for this test case.          ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ Expected array length: 3            ‚îÇ
‚îÇ But got: 2                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîß Language Support

### Currently Supported

#### JavaScript (Fully Functional)
```javascript
/**
 * @param {number[]} nums
 * @return {number}
 */
var solution = function(nums) {
    // Your code here
};
```

#### Python, Java, C++ (Simulated)
- Code structure validation
- Simulated execution
- Ready for real execution implementation

### Adding Real Execution

To enable actual code execution for other languages:

1. **Python**:
   ```javascript
   const { spawn } = require('child_process');
   const python = spawn('python3', ['-c', code]);
   ```

2. **Java**:
   ```javascript
   // Compile: javac Solution.java
   // Execute: java Solution
   ```

3. **C++**:
   ```javascript
   // Compile: g++ solution.cpp -o solution
   // Execute: ./solution
   ```

**Security Note**: Use Docker containers or sandboxed environments for production!

---

## üîí Security Considerations

### Current Implementation (Development)

- ‚ö†Ô∏è Uses `eval()` for JavaScript execution
- ‚ö†Ô∏è No sandboxing
- ‚ö†Ô∏è No resource limits

### Production Requirements

1. **Use Docker Containers**
   ```javascript
   docker run --rm \
     --cpus=0.5 \
     --memory=128m \
     --timeout=5s \
     --network=none \
     user-code-image
   ```

2. **Implement Resource Limits**
   - CPU time limit (e.g., 1-5 seconds)
   - Memory limit (e.g., 128-256 MB)
   - Network isolation
   - File system restrictions

3. **Use Sandboxing Services**
   - [Judge0](https://github.com/judge0/judge0)
   - [Piston](https://github.com/engineer-man/piston)
   - [CodeX Executor](https://github.com/Jaagrav/CodeX)

---

## üìà Performance Optimization

### Caching

```javascript
// Cache compiled code
const compiledCache = new Map();

// Cache test results for identical code
const resultCache = new Map();
```

### Parallel Execution

```javascript
// Run independent test cases in parallel
const results = await Promise.all(
  testCases.map(tc => executeTestCase(code, language, tc))
);
```

### Resource Management

```javascript
// Limit concurrent executions
const executionQueue = new Queue({ concurrency: 10 });
```

---

## üêõ Debugging Features

### For Users

1. **Detailed Error Messages**
   - Shows exact input that failed
   - Compares expected vs actual
   - Suggests possible issues

2. **Test Case Visibility**
   - Run shows visible cases
   - Submit shows all cases
   - Clear indication of hidden tests

3. **Debugging Tips**
   - Check edge cases
   - Verify data types
   - Test manually
   - Review constraints

### For Developers

```javascript
// Enable debug logging
const DEBUG = process.env.DEBUG_EXECUTOR === 'true';

if (DEBUG) {
  console.log('Input:', parsedInput);
  console.log('Output:', result);
  console.log('Expected:', expected);
}
```

---

## üìù Usage Examples

### Run Code

```javascript
// Frontend
const handleRun = async () => {
  const { data } = await submissionsAPI.run({
    problemId: problem._id,
    code: userCode,
    language: 'javascript'
  });
  
  // data.executionResult contains:
  // - status
  // - testResults (visible only)
  // - runtime, memory
};
```

### Submit Code

```javascript
// Frontend
const handleSubmit = async () => {
  const { data } = await submissionsAPI.submit({
    problemId: problem._id,
    code: userCode,
    language: 'javascript'
  });
  
  // data.executionResult contains:
  // - status
  // - testResults (all tests)
  // - runtime, memory
  // - saved to database
};
```

---

## üéØ Future Enhancements

### Planned Features

1. **Real-time Execution**
   - WebSocket for live updates
   - Progress indicators
   - Cancellable execution

2. **Code Analysis**
   - Time complexity analysis
   - Space complexity analysis
   - Code quality metrics

3. **Custom Test Cases**
   - Let users add their own tests
   - Save custom test suites
   - Share test cases

4. **Video Explanations**
   - Embed solution videos
   - Step-by-step walkthroughs
   - Visual debugging

5. **AI Assistance**
   - GPT-powered hints
   - Code review suggestions
   - Bug detection

---

## üöÄ Getting Started

### 1. Test the System

1. Start backend and frontend servers
2. Navigate to any problem
3. Write a solution
4. Click "Run Code" to test visible cases
5. Fix any errors
6. Click "Submit" to test all cases

### 2. Example Problem Test

```javascript
// Problem: Sum of Array
// Input: [1, 2, 3, 4]
// Expected Output: 10

function solution(nums) {
  return nums.reduce((a, b) => a + b, 0);
}

// This will:
// ‚úÖ Pass Test 1: [1,2,3,4] ‚Üí 10
// ‚úÖ Pass Test 2: [5,5] ‚Üí 10
// ‚úÖ Pass Test 3: [] ‚Üí 0
```

### 3. View Results

- **Test Cases Tab**: See which tests passed/failed
- **Submission Tab**: See full results after submit
- **Performance**: Check runtime and memory usage

---

## üìû Troubleshooting

### Issue: "Compilation Error"

**Solution**: Check your code syntax
- Missing brackets, semicolons
- Typos in function names
- Incorrect language selected

### Issue: "Runtime Error"

**Solution**: Check your logic
- Null/undefined errors
- Array index out of bounds
- Division by zero

### Issue: "Wrong Answer"

**Solution**: Debug your algorithm
- Check edge cases
- Verify data types
- Test with examples manually
- Review problem constraints

---

## üéâ Summary

Your DSA platform now has a **complete code execution system** like LeetCode:

‚úÖ Detailed test case results  
‚úÖ Error explanations  
‚úÖ Performance metrics  
‚úÖ Run vs Submit modes  
‚úÖ Beautiful UI  
‚úÖ Multiple language support (structure ready)  

**Happy Coding! üöÄüíª**
